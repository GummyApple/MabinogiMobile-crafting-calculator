<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œì‘ ì¬ë£Œ ê³„ì‚°ê¸°</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Malgun Gothic', sans-serif;
        }
        body {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .panel h2 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .input-panel h2 { color: #70AD47; }
        .result-panel h2 { color: #ED7D31; }
        .recipe-panel h2 { color: #4472C4; }
        
        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        .input-row select {
            flex: 2;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .input-row input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
        }
        .input-row button {
            padding: 8px 12px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .input-row button:hover {
            background: #ee5a5a;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-calc {
            background: #70AD47;
            color: white;
        }
        .btn-calc:hover { background: #5d9438; }
        .btn-add {
            background: #4472C4;
            color: white;
        }
        .btn-add:hover { background: #3761b0; }
        .btn-clear {
            background: #888;
            color: white;
        }
        .btn-clear:hover { background: #666; }
        
        .result-section {
            margin-bottom: 20px;
        }
        .result-section h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #666;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
        }
        .result-table th, .result-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .result-table th {
            background: #f8f8f8;
            font-weight: bold;
        }
        .result-table .qty {
            text-align: right;
            font-weight: bold;
            color: #ED7D31;
        }
        .result-table .crafts {
            text-align: right;
            color: #4472C4;
        }
        
        .recipe-list {
            max-height: 500px;
            overflow-y: auto;
        }
        .recipe-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #4472C4;
            transition: background 0.2s, transform 0.1s;
        }
        .recipe-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }
        .recipe-item.intermediate {
            border-left-color: #ED7D31;
        }
        .recipe-name {
            font-weight: bold;
            color: #333;
        }
        .recipe-yield {
            font-size: 12px;
            color: #888;
            margin-left: 8px;
        }
        .recipe-materials {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }
        
        .empty-msg {
            color: #999;
            text-align: center;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ”¨ ì œì‘ ì¬ë£Œ ê³„ì‚°ê¸°</h1>
    
    <div class="container">
        <div class="left-col">
            <div class="panel input-panel">
                <h2>ğŸ“ ì œì‘ ëª©ë¡</h2>
                <div id="inputList"></div>
                <div class="btn-group">
                    <button class="btn btn-add" onclick="addInputRow()">+ ì¶”ê°€</button>
                    <button class="btn btn-clear" onclick="clearAll()">ì´ˆê¸°í™”</button>
                </div>
                <div class="btn-group">
                    <button class="btn btn-calc" onclick="calculate()">ğŸ” ê³„ì‚°í•˜ê¸°</button>
                </div>
            </div>
            
            <div class="panel recipe-panel" style="margin-top: 20px;">
                <h2>ğŸ“– ë ˆì‹œí”¼ ëª©ë¡ <span style="font-size: 12px; color: #888; font-weight: normal;">(í´ë¦­: ì¶”ê°€ / ìš°í´ë¦­: ì œê±°)</span></h2>
                <div id="recipeList" class="recipe-list"></div>
            </div>
        </div>
        
        <div class="panel result-panel">
            <h2>ğŸ“¦ ê³„ì‚° ê²°ê³¼</h2>
            <div id="resultArea">
                <p class="empty-msg">ì™¼ìª½ì—ì„œ ì•„ì´í…œì„ ì„ íƒí•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
            </div>
        </div>
    </div>

    <script>
        // ë ˆì‹œí”¼ ë°ì´í„°ë² ì´ìŠ¤
        const recipes = {
            // ìš”ë¦¬
            "ì•¼ì±„ë³¶ìŒ": {
                yield: 1,
                materials: [
                    { name: "ê°ì", qty: 8 },
                    { name: "ì–‘íŒŒ", qty: 3 },
                    { name: "ì–‘ë°°ì¶”", qty: 6 },
                    { name: "í—ˆë¸Œ", qty: 2 }
                ]
            },
            "ì¹´ë ˆë¼ì´ìŠ¤": {
                yield: 1,
                materials: [
                    { name: "ê³ ê¸°", qty: 10 },
                    { name: "ë°¥", qty: 3 },
                    { name: "ë‹¹ê·¼", qty: 3 },
                    { name: "ê°ì", qty: 8 },
                    { name: "ì¹´ë ˆ ê°€ë£¨", qty: 2 }
                ]
            },
            "ë†ì–´ ë§¤ìš´íƒ•": {
                yield: 1,
                materials: [
                    { name: "ë†ì–´", qty: 6 },
                    { name: "ë¬´", qty: 4 },
                    { name: "ì–‘íŒŒ", qty: 6 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 5 },
                    { name: "ê³ ì¶§ê°€ë£¨", qty: 4 },
                    { name: "í›„ì¶”", qty: 2 }
                ]
            },
            "ê¸ˆì€ ë§¤ìš´íƒ•": {
                yield: 1,
                materials: [
                    { name: "ê¸ˆë¦°ì–´", qty: 4 },
                    { name: "ì€ë¶•ì–´", qty: 4 },
                    { name: "ë¬´", qty: 6 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 5 },
                    { name: "ì–‘íŒŒ", qty: 10 },
                    { name: "ê³ ì¶§ê°€ë£¨", qty: 4 }
                ]
            },
            "ëŒ€ë§Œì°¬": {
                yield: 1,
                materials: [
                    { name: "ë§Œì°¬ ì¬ë£Œ: êº¼ì§€ì§€ ì•ŠëŠ” ë¶ˆ", qty: 4 },
                    { name: "ìˆ™ì„±ëœ ì»¤ë‹¤ë€ ê³ ê¸°", qty: 8 },
                    { name: "ë¬µì§í•œ ê°ì", qty: 24 },
                    { name: "í† ë§ˆí† ", qty: 16 },
                    { name: "ì–‘íŒŒ", qty: 6 },
                    { name: "íŒŒìŠ¤ë‹™", qty: 16 },
                    { name: "ì†Œê¸ˆ", qty: 4 }
                ]
            },
            "ë…¹ì°¨ í¬ë ˆì´í”„ ì¼€ì´í¬": {
                yield: 1,
                materials: [
                    { name: "ë§ë¦° ì°»ì", qty: 10 },
                    { name: "ë”¸ê¸°", qty: 6 },
                    { name: "ìƒí¬ë¦¼", qty: 6 },
                    { name: "ë°€ê°€ë£¨", qty: 4 },
                    { name: "ì„¤íƒ•", qty: 6 }
                ]
            },
            "ì‚¬ê³¼ ìƒí¬ë¦¼ ì¼€ì´í¬": {
                yield: 1,
                materials: [
                    { name: "ì‚¬ê³¼", qty: 12 },
                    { name: "ìƒí¬ë¦¼", qty: 2 },
                    { name: "ë°€ê°€ë£¨", qty: 4 },
                    { name: "ì„¤íƒ•", qty: 9 }
                ]
            },
            "í˜¸ë°• ìˆ˜í”„": {
                yield: 1,
                materials: [
                    { name: "í˜¸ë°•", qty: 10 },
                    { name: "ê°ì", qty: 6 },
                    { name: "ì–‘íŒŒ", qty: 6 },
                    { name: "ìƒê°•", qty: 2 },
                    { name: "ìƒí¬ë¦¼", qty: 5 }
                ]
            },
            "ìƒ¤ì™€ë¥´ë§ˆ": {
                yield: 1,
                materials: [
                    { name: "ë‹´ë°±í•œ ê³ ê¸°", qty: 10 },
                    { name: "ì½©", qty: 12 },
                    { name: "ë°€ê°€ë£¨", qty: 3 },
                    { name: "ì–‘ë°°ì¶”", qty: 5 },
                    { name: "ë ˆëª¬", qty: 2 }
                ]
            },
            "ì§œë¨¹ëŠ” ê°„ì‹": {
                yield: 1,
                materials: [
                    { name: "ê³ ê¸°", qty: 3 },
                    { name: "í—ˆë¸Œ", qty: 1 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 1 }
                ]
            },
            "í™ì°¨": {
                yield: 1,
                materials: [
                    { name: "ë°œíš¨ëœ ì°»ì", qty: 8 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 4 },
                    { name: "ì˜·ê°", qty: 2 }
                ]
            },
            "ë…¹ì°¨": {
                yield: 1,
                materials: [
                    { name: "ë§ë¦° ì°»ì", qty: 8 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 4 }
                ]
            },
            "í¬ë¦¼ì†ŒìŠ¤ ìŠ¤í…Œì´í¬": {
                yield: 1,
                materials: [
                    { name: "ê³ ê¸°", qty: 10 },
                    { name: "ìƒí¬ë¦¼", qty: 2 },
                    { name: "ë§ˆëŠ˜", qty: 2 },
                    { name: "í›„ì¶”", qty: 3 }
                ]
            },
            "ì‚¬ê³¼ ìˆ˜í”Œë ˆ": {
                yield: 1,
                materials: [
                    { name: "ì‚¬ê³¼", qty: 8 },
                    { name: "ë°€ê°€ë£¨", qty: 2 },
                    { name: "ë‹¬ê±€", qty: 4 },
                    { name: "ì„¤íƒ•", qty: 4 }
                ]
            },
            "ê³ ë“±ì–´ì™€ ì—°ì–´ ìŠ¤í…Œì´í¬": {
                yield: 1,
                materials: [
                    { name: "ê³ ë“±ì–´", qty: 5 },
                    { name: "ì—°ì–´", qty: 3 },
                    { name: "ë§ˆìš”ë„¤ì¦ˆ", qty: 2 },
                    { name: "ì•„ìŠ¤íŒŒë¼ê±°ìŠ¤", qty: 4 },
                    { name: "ì†Œê¸ˆ", qty: 2 },
                    { name: "í›„ì¶”", qty: 3 }
                ]
            },
            
            // ì¤‘ê°„ ì¬ë£Œ
            "ë°¥": {
                yield: 3,
                materials: [
                    { name: "ë¬¼ì— ë¶ˆë¦° ìŒ€", qty: 8 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 2 }
                ]
            },
            "ë¬¼ì— ë¶ˆë¦° ìŒ€": {
                yield: 5,
                materials: [
                    { name: "ìŒ€", qty: 30 },
                    { name: "ë¬¼ì´ ë“  ë³‘", qty: 6 }
                ]
            },
            "ìˆ™ì„±ëœ ì»¤ë‹¤ë€ ê³ ê¸°": {
                yield: 1,
                materials: [
                    { name: "ì»¤ë‹¤ë€ ê³ ê¸°", qty: 1 },
                    { name: "í—ˆë¸Œ", qty: 6 },
                    { name: "ë§ˆëŠ˜", qty: 2 },
                    { name: "ì†Œê¸ˆ", qty: 2 },
                    { name: "í›„ì¶”", qty: 1 }
                ]
            },
            "ë§ë¦° ì°»ì": {
                yield: 3,
                materials: [
                    { name: "ì°»ì", qty: 30 }
                ]
            },
            "ìƒí¬ë¦¼": {
                yield: 3,
                materials: [
                    { name: "ìš°ìœ ", qty: 12 },
                    { name: "ë‹¬ê±€", qty: 6 },
                    { name: "ì„¤íƒ•", qty: 2 }
                ]
            },
            "ë°€ê°€ë£¨": {
                yield: 3,
                materials: [
                    { name: "ë°€", qty: 15 }
                ]
            },
            "ë°œíš¨ëœ ì°»ì": {
                yield: 3,
                materials: [
                    { name: "ë§ë¦° ì°»ì", qty: 5 },
                    { name: "ì˜·ê°", qty: 1 }
                ]
            },
            "ë§ˆìš”ë„¤ì¦ˆ": {
                yield: 3,
                materials: [
                    { name: "ë‹¬ê±€", qty: 10 },
                    { name: "ì‹ìš©ìœ ", qty: 2 }
                ]
            }
        };

        // ì¤‘ê°„ ì¬ë£Œ íŒë³„ (ë‹¤ë¥¸ ë ˆì‹œí”¼ì˜ ì¬ë£Œë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒ)
        const intermediateSet = new Set();
        Object.values(recipes).forEach(recipe => {
            recipe.materials.forEach(mat => {
                if (recipes[mat.name]) {
                    intermediateSet.add(mat.name);
                }
            });
        });

        // ì•„ì´í…œ ëª©ë¡ (ì™„ì„±í’ˆ ë¨¼ì € ê°€ë‚˜ë‹¤ìˆœ, ì¤‘ê°„ì¬ë£Œ ì•„ë˜ ê°€ë‚˜ë‹¤ìˆœ)
        const itemList = Object.keys(recipes).sort((a, b) => {
            const aIsIntermediate = intermediateSet.has(a);
            const bIsIntermediate = intermediateSet.has(b);
            if (aIsIntermediate !== bIsIntermediate) {
                return aIsIntermediate ? 1 : -1;
            }
            return a.localeCompare(b, 'ko');
        });

        // ì œì‘ ëª©ë¡ ì €ì¥
        function saveList() {
            const rows = document.querySelectorAll('#inputList .input-row');
            const items = [];
            rows.forEach(row => {
                const select = row.querySelector('select');
                const input = row.querySelector('input');
                if (select.value) {
                    items.push({ name: select.value, qty: parseInt(input.value) || 1 });
                }
            });
            localStorage.setItem('craftingList', JSON.stringify(items));
        }

        // ì œì‘ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadList() {
            const saved = localStorage.getItem('craftingList');
            if (saved) {
                const items = JSON.parse(saved);
                const container = document.getElementById('inputList');
                container.innerHTML = '';
                
                if (items.length === 0) {
                    addInputRow();
                    return;
                }
                
                items.forEach(item => {
                    const row = document.createElement('div');
                    row.className = 'input-row';
                    
                    let options = '<option value="">-- ì„ íƒ --</option>';
                    let addedSeparator = false;
                    itemList.forEach(i => {
                        if (!addedSeparator && intermediateSet.has(i)) {
                            options += '<option disabled>â”€â”€ ì¤‘ê°„ ì¬ë£Œ â”€â”€</option>';
                            addedSeparator = true;
                        }
                        const selected = i === item.name ? 'selected' : '';
                        options += `<option value="${i}" ${selected}>${i}</option>`;
                    });
                    
                    row.innerHTML = `
                        <select onchange="saveList()">${options}</select>
                        <input type="number" value="${item.qty}" min="1" onchange="saveList()">
                        <button onclick="this.parentElement.remove(); saveList();">âœ•</button>
                    `;
                    container.appendChild(row);
                });
            } else {
                addInputRow();
            }
        }

        // ë ˆì‹œí”¼ í´ë¦­ ì‹œ ì œì‘ ëª©ë¡ì— ì¶”ê°€
        function addItemToList(itemName) {
            const container = document.getElementById('inputList');
            const rows = container.querySelectorAll('.input-row');
            
            // ë¹ˆ í–‰(-- ì„ íƒ -- ìƒíƒœ) ì œê±°
            rows.forEach(row => {
                const select = row.querySelector('select');
                if (select.value === '') {
                    row.remove();
                }
            });
            
            // ì´ë¯¸ ê°™ì€ ì•„ì´í…œì´ ìˆëŠ”ì§€ í™•ì¸
            const existingRows = container.querySelectorAll('.input-row');
            for (let row of existingRows) {
                const select = row.querySelector('select');
                if (select.value === itemName) {
                    // ìˆ˜ëŸ‰ +1
                    const input = row.querySelector('input');
                    input.value = parseInt(input.value) + 1;
                    saveList();
                    return;
                }
            }
            
            // ì—†ìœ¼ë©´ ìƒˆ í–‰ ì¶”ê°€
            const row = document.createElement('div');
            row.className = 'input-row';
            
            let options = '<option value="">-- ì„ íƒ --</option>';
            let addedSeparator = false;
            itemList.forEach(item => {
                if (!addedSeparator && intermediateSet.has(item)) {
                    options += '<option disabled>â”€â”€ ì¤‘ê°„ ì¬ë£Œ â”€â”€</option>';
                    addedSeparator = true;
                }
                const selected = item === itemName ? 'selected' : '';
                options += `<option value="${item}" ${selected}>${item}</option>`;
            });
            
            row.innerHTML = `
                <select onchange="saveList()">${options}</select>
                <input type="number" value="1" min="1" onchange="saveList()">
                <button onclick="this.parentElement.remove(); saveList();">âœ•</button>
            `;
            container.appendChild(row);
            
            // ìŠ¤í¬ë¡¤ì„ ì…ë ¥ ì˜ì—­ìœ¼ë¡œ ì´ë™
            row.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            saveList();
        }

        // ë ˆì‹œí”¼ ìš°í´ë¦­ ì‹œ ì œì‘ ëª©ë¡ì—ì„œ ìˆ˜ëŸ‰ ê°ì†Œ
        function removeItemFromList(itemName) {
            const rows = document.querySelectorAll('#inputList .input-row');
            
            // í•´ë‹¹ ì•„ì´í…œì´ ìˆëŠ” í–‰ì„ ì°¾ì•„ì„œ ìˆ˜ëŸ‰ ê°ì†Œ
            for (let i = rows.length - 1; i >= 0; i--) {
                const select = rows[i].querySelector('select');
                if (select.value === itemName) {
                    const input = rows[i].querySelector('input');
                    const newValue = parseInt(input.value) - 1;
                    if (newValue <= 0) {
                        rows[i].remove();
                    } else {
                        input.value = newValue;
                    }
                    saveList();
                    return;
                }
            }
        }

        // ì…ë ¥ í–‰ ì¶”ê°€
        function addInputRow() {
            const container = document.getElementById('inputList');
            const row = document.createElement('div');
            row.className = 'input-row';
            
            let options = '<option value="">-- ì„ íƒ --</option>';
            let addedSeparator = false;
            itemList.forEach(item => {
                if (!addedSeparator && intermediateSet.has(item)) {
                    options += '<option disabled>â”€â”€ ì¤‘ê°„ ì¬ë£Œ â”€â”€</option>';
                    addedSeparator = true;
                }
                options += `<option value="${item}">${item}</option>`;
            });
            
            row.innerHTML = `
                <select onchange="saveList()">${options}</select>
                <input type="number" value="1" min="1" onchange="saveList()">
                <button onclick="this.parentElement.remove(); saveList();">âœ•</button>
            `;
            container.appendChild(row);
        }

        // ì´ˆê¸°í™”
        function clearAll() {
            document.getElementById('inputList').innerHTML = '';
            document.getElementById('resultArea').innerHTML = 
                '<p class="empty-msg">ì™¼ìª½ì—ì„œ ì•„ì´í…œì„ ì„ íƒí•˜ê³  ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>';
            localStorage.removeItem('craftingList');
            addInputRow();
        }

        // ì¬ê·€ì  ì¬ë£Œ ê³„ì‚°
        function calculateMaterials(item, quantity, baseMaterials, intermediateCrafts, requestedItems) {
            if (!recipes[item]) {
                // ê¸°ì´ˆ ì¬ë£Œ
                baseMaterials[item] = (baseMaterials[item] || 0) + quantity;
                return;
            }

            const recipe = recipes[item];
            const craftsNeeded = Math.ceil(quantity / recipe.yield);
            
            // ì¤‘ê°„ ì¬ë£Œ ì œì‘ íšŸìˆ˜ ê¸°ë¡
            intermediateCrafts[item] = (intermediateCrafts[item] || 0) + craftsNeeded;

            // ê° ì¬ë£Œì— ëŒ€í•´ ì¬ê·€ í˜¸ì¶œ
            recipe.materials.forEach(mat => {
                const totalNeeded = mat.qty * craftsNeeded;
                calculateMaterials(mat.name, totalNeeded, baseMaterials, intermediateCrafts, requestedItems);
            });
        }

        // ê³„ì‚° ì‹¤í–‰
        function calculate() {
            const rows = document.querySelectorAll('#inputList .input-row');
            const requests = [];
            
            rows.forEach(row => {
                const item = row.querySelector('select').value;
                const qty = parseInt(row.querySelector('input').value) || 0;
                if (item && qty > 0) {
                    requests.push({ item, qty });
                }
            });

            if (requests.length === 0) {
                alert('ì œì‘í•  ì•„ì´í…œì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const baseMaterials = {};
            const intermediateCrafts = {};
            const requestedItems = new Set(requests.map(r => r.item));

            // ê³„ì‚° ì‹¤í–‰
            requests.forEach(({ item, qty }) => {
                calculateMaterials(item, qty, baseMaterials, intermediateCrafts, requestedItems);
            });

            // ìš”ì²­í•œ ì•„ì´í…œì€ ì¤‘ê°„ì¬ë£Œ ëª©ë¡ì—ì„œ ì œì™¸
            requests.forEach(({ item, qty }) => {
                if (intermediateCrafts[item]) {
                    const recipe = recipes[item];
                    intermediateCrafts[item] -= Math.ceil(qty / recipe.yield);
                    if (intermediateCrafts[item] <= 0) {
                        delete intermediateCrafts[item];
                    }
                }
            });

            // ê²°ê³¼ í‘œì‹œ
            displayResults(baseMaterials, intermediateCrafts);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(baseMaterials, intermediateCrafts) {
            const resultArea = document.getElementById('resultArea');
            
            let html = '<div class="result-section">';
            html += '<h3>ğŸŒ¿ í•„ìš”í•œ ê¸°ì´ˆ ì¬ë£Œ</h3>';
            html += '<table class="result-table">';
            html += '<tr><th>ì¬ë£Œëª…</th><th style="width: 100px; text-align: right;">í•„ìš” ìˆ˜ëŸ‰</th></tr>';
            
            Object.entries(baseMaterials)
                .sort((a, b) => a[0].localeCompare(b[0], 'ko'))
                .forEach(([name, qty]) => {
                    html += `<tr><td>${name}</td><td class="qty">${qty}ê°œ</td></tr>`;
                });
            
            html += '</table></div>';

            // ì¤‘ê°„ ì¬ë£Œê°€ ìˆìœ¼ë©´ í‘œì‹œ
            const intermediateItems = Object.entries(intermediateCrafts);
            if (intermediateItems.length > 0) {
                html += '<div class="result-section">';
                html += '<h3>âš™ï¸ ì¤‘ê°„ ì¬ë£Œ ì œì‘ íšŸìˆ˜</h3>';
                html += '<table class="result-table">';
                html += '<tr><th>ì¤‘ê°„ ì¬ë£Œ</th><th style="width: 100px; text-align: right; white-space: nowrap;">ì œì‘ íšŸìˆ˜</th><th style="width: 80px; text-align: right; white-space: nowrap;">ìƒì‚°ëŸ‰</th></tr>';
                
                intermediateItems
                    .sort((a, b) => a[0].localeCompare(b[0], 'ko'))
                    .forEach(([name, crafts]) => {
                        const recipe = recipes[name];
                        const totalYield = crafts * recipe.yield;
                        html += `<tr><td>${name}</td><td class="crafts">${crafts}íšŒ</td><td class="crafts">${totalYield}ê°œ</td></tr>`;
                    });
                
                html += '</table></div>';
            }

            resultArea.innerHTML = html;
        }

        // ë ˆì‹œí”¼ ëª©ë¡ í‘œì‹œ
        function displayRecipes() {
            const container = document.getElementById('recipeList');
            let html = '';
            
            // ì¤‘ê°„ ì¬ë£Œ ëª©ë¡ (ë‹¤ë¥¸ ë ˆì‹œí”¼ì˜ ì¬ë£Œë¡œ ì‚¬ìš©ë˜ëŠ” ê²ƒ)
            const intermediates = new Set();
            Object.values(recipes).forEach(recipe => {
                recipe.materials.forEach(mat => {
                    if (recipes[mat.name]) {
                        intermediates.add(mat.name);
                    }
                });
            });
            
            // ì™„ì„±í’ˆ ë¨¼ì € ê°€ë‚˜ë‹¤ìˆœ, ì¤‘ê°„ì¬ë£Œ ì•„ë˜ ê°€ë‚˜ë‹¤ìˆœ
            const sortedRecipes = Object.entries(recipes)
                .sort((a, b) => {
                    const aIsIntermediate = intermediates.has(a[0]);
                    const bIsIntermediate = intermediates.has(b[0]);
                    if (aIsIntermediate !== bIsIntermediate) {
                        return aIsIntermediate ? 1 : -1;
                    }
                    return a[0].localeCompare(b[0], 'ko');
                });
            
            let addedHeader = false;
            sortedRecipes.forEach(([name, recipe]) => {
                const materials = recipe.materials
                    .map(m => `${m.name} ${m.qty}ê°œ`)
                    .join(', ');
                
                const isIntermediate = intermediates.has(name);
                
                // ì¤‘ê°„ ì¬ë£Œ ì„¹ì…˜ ì‹œì‘ì‹œ í—¤ë” ì¶”ê°€
                if (!addedHeader && isIntermediate) {
                    html += '<div style="margin: 15px 0 10px 0; padding: 5px; background: #ED7D31; color: white; border-radius: 5px; text-align: center; font-weight: bold;">âš™ï¸ ì¤‘ê°„ ì¬ë£Œ</div>';
                    addedHeader = true;
                }
                
                html += `
                    <div class="recipe-item ${isIntermediate ? 'intermediate' : ''}" onclick="addItemToList('${name}')" oncontextmenu="removeItemFromList('${name}'); return false;" style="cursor: pointer;">
                        <span class="recipe-name">${name}</span>
                        <span class="recipe-yield">(${recipe.yield}ê°œ ìƒì‚°)</span>
                        <div class="recipe-materials">â†’ ${materials}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            displayRecipes();
            loadList();
        };
    </script>
</body>
</html>
